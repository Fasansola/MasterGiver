{% extends "signup-flow.html" %}
{% load static %}

{% block page_title %}Create An Account{% endblock %}

{% block page_body %}
<!-- Main form container -->
<form
  class="d-flex flex-column align-items-start forms"
  enctype="multipart/form-data"
  action="{% url 'what_care_about' %}"
  method="POST"
  aria-label="MasterGiver Profile Creation Form"
  novalidate
>
  {% csrf_token %}

  <!-- Why I Give section -->
  <div class="forms-div">
    <label for="why_i_give" class="small-text required" id="why_i_give_label">Why I Give</label>
    <textarea
      class="input"
      name="why_i_give"
      id="why_i_give"
      rows="4"
      placeholder="Provide details on why giving is important to you"
      aria-labelledby="why_i_give_label"
      aria-required="true"
      minlength="10"
      maxlength="500"
    ></textarea>
    <span id="why_i_give-error" class="error-message" aria-live="polite"></span>
  </div>

  <!-- What I Care About section -->
  <div class="forms-div relative">
    <label for="what_i_care_about" class="small-text required" id="what_i_care_about_label">What I Care About</label>
    <input
      type="text"
      id="what_i_care_about"
      placeholder="Select one or more causes you care to support"
      class="input"
      aria-labelledby="what_i_care_about_label"
      aria-required="true"
      aria-haspopup="true"
      aria-expanded="false"
    />
    <span id="what_i_care_about-error" class="error-message" aria-live="polite"></span>

    <!-- Dropdown for selecting causes -->
    <div
      class="absolute dropdown-list"
      id="causes-dropdown"
      role="listbox"
      aria-labelledby="what_i_care_about_label"
    >
      <h4 class="bold dropdown-h" id="causes-dropdown-title">What I Care About</h4>
      <div class="dropdown-ul">
        {% for cause in causes %}
        <div
          class="checkbox-div justify-content-between align-items-center"
          role="option"
          aria-selected="false"
        >
          <label for="{{ cause.name }}" class="small-text icons-text">
            <img src="{{ cause.icon.url }}" alt="" aria-hidden="true" />
            {{ cause.name }}
          </label>
          <input
            type="checkbox"
            name="causes"
            id="{{ cause.name }}"
            class="causes-check skill-causes-items"
            value="{{ cause.id }}"
            aria-labelledby="causes-dropdown-title"
          />
        </div>
        {% endfor %}
      </div>
      <div class="dropdown-btn">
        <div
          class="button dark-button"
          id="causes-btn"
          role="button"
          aria-label="Save selected causes"
        >
          Save
        </div>
      </div>
    </div>
  </div>

  <!-- Container for displaying selected causes -->
  <div
    class="d-none items-container"
    aria-live="polite"
    aria-relevant="additions removals"
  >
    {% for cause in causes %}
    <div class="d-none items-box causes-items" role="listitem">
      <div class="icons-text">
        <img src="{{ cause.icon.url }}" alt="" aria-hidden="true" />
        <p>{{ cause.name }}</p>
      </div>
      <div>
        <img
          src="{% static '/icons/x-close.svg' %}"
          alt="Remove {{ cause.name }}"
          class="remove-parent clickable"
          role="button"
          aria-label="Remove {{ cause.name }}"
        />
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Giving Skills section -->
  <div class="forms-div relative">
    <label for="giving_skills" class="small-text required" id="giving_skills_label">Giving Skills</label>
    <input
      type="text"
      id="giving_skills"
      placeholder="Select one or more skills you have that you can offer for a cause"
      class="input"
      aria-labelledby="giving_skills_label"
      aria-required="true"
      aria-haspopup="true"
      aria-expanded="false"
    />
    <span id="giving_skills-error" class="error-message" aria-live="polite"></span>

    <!-- Dropdown for selecting skills -->
    <div
      class="absolute dropdown-list"
      id="skills-dropdown"
      role="listbox"
      aria-labelledby="giving_skills_label"
    >
      <h4 class="bold dropdown-h" id="skills-dropdown-title">Giving Skills</h4>
      <div class="dropdown-ul">
        {% for skill in skills %}
        <div
          class="checkbox-div justify-content-between align-items-center"
          role="option"
          aria-selected="false"
        >
          <label for="{{ skill.name }}" class="small-text icons-text">{{ skill.name }}</label>
          <input
            type="checkbox"
            name="skills"
            id="{{ skill.name }}"
            value="{{ skill.id }}"
            class="skills-check skill-causes-items"
            aria-labelledby="skills-dropdown-title"
          />
        </div>
        {% endfor %}
      </div>
      <div class="dropdown-btn">
        <div
          class="button dark-button"
          id="skills-btn"
          role="button"
          aria-label="Save selected skills"
        >
          Save
        </div>
      </div>
    </div>
  </div>

  <!-- Container for displaying selected skills -->
  <div
    class="d-none items-container"
    aria-live="polite"
    aria-relevant="additions removals"
  >
    {% for skill in skills %}
    <div class="d-none items-box skills-items" role="listitem">
      <div class="icons-text">
        <p>{{ skill.name }}</p>
      </div>
      <div>
        <img
          src="{% static '/icons/x-close.svg' %}"
          alt="Remove {{ skill.name }}"
          class="remove-parent clickable"
          role="button"
          aria-label="Remove {{ skill.name }}"
        />
      </div>
    </div>
    {% endfor %}
  </div>

  <hr class="line" aria-hidden="true">

  <!-- My Organizations and Causes section -->
  <div class="forms-div relative">
    <label for="search-org" id="search-org-label">My Organizations and Causes</label>
    <h3 class="heading">Find Your Charity or Cause</h3>
    <div class="input organizations-search" role="search">
      <img src="{% static 'icons/search.svg' %}" alt="" aria-hidden="true" />
      <input
        type="text"
        id="search-org"
        placeholder="Find Your Charity or Cause"
        class="organizations-search-input"
        aria-labelledby="search-org-label"
      />
    </div>

    <!-- Dropdown for displaying search results -->
    <div
      class="absolute dropdown-list"
      id="organizations-dropdown"
      role="listbox"
      aria-labelledby="search-org-label"
    >
      <h4 class="bold dropdown-h">Charities</h4>
      <div id="org-list"></div>
      <div class="organization-footer bold">Show the world your good side</div>
    </div>
  </div>

  <!-- Add organization manually section -->
  <div class="d-flex flex-column">
    <div
      class="add-manually"
      id="organization-add-manually"
      role="button"
      aria-expanded="false"
      aria-controls="add-user-organization"
    >
      <img src="{% static 'icons/add-manually.svg' %}" alt="" aria-hidden="true" />
      <p>Add Manually</p>
    </div>
    <div class="d-none" id="add-user-organization">
      <label for="user-organization" class="bold" id="user-organization-label">My Organizations or Event Name</label>
      <input
        type="text"
        class="input"
        id="user-organization"
        aria-labelledby="user-organization-label"
        maxlength="40"
      />
      <button
        type="button"
        class="forms-submit-button button dark-button clickable"
        id="custom-org-btn"
        aria-label="Save custom organization"
      >
        Save
      </button>
    </div>
  </div>

  <!-- Container for displaying selected organizations -->
  <div
    class="d-none items-container"
    id="org-boxes"
    aria-live="polite"
    aria-relevant="additions removals"
  >
    <!-- JavaScript will add organizations here -->
  </div>

  <!-- Error message display -->
  {% if error %}
  <div class="danger-text forms-warning" role="alert">
    <img src="{% static "icons/error.svg" %}" alt="" aria-hidden="true"> {{ error }}
  </div>
  {% endif %}

  <button type="submit" class="forms-submit-button button dark-button">Next</button>
</form>
{% endblock %}

{% block page_scripts %}
<script>
  // Define static URLs for use in JavaScript
  const STATIC_URLS = {
    locationIcon: "{% static 'icons/location.svg' %}",
    verticalLineIcon: "{% static 'icons/vertical-line.svg' %}",
    closeIcon: "{% static 'icons/x-close.svg' %}",
  };
</script>
<!-- Include custom JavaScript files -->
<script src="{% static 'scripts/what_care_about.js' %}"></script>
<script src="{% static 'scripts/organization-search.js' %}"></script>
{% endblock %}